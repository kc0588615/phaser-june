"use strict";(globalThis.webpackChunkwiki=globalThis.webpackChunkwiki||[]).push([[73332],{28453(e,i,n){n.d(i,{R:()=>l,x:()=>a});var s=n(96540);const t={},r=s.createContext(t);function l(e){const i=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(i):{...i,...e}},[i,e])}function a(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),s.createElement(r.Provider,{value:i},e.children)}},90464(e,i,n){n.r(i),n.d(i,{assets:()=>d,contentTitle:()=>a,default:()=>u,frontMatter:()=>l,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"getting-started/environment-setup","title":"Environment Setup","description":"Detailed configuration for all external services","source":"@site/docs/getting-started/environment-setup.md","sourceDirName":"getting-started","slug":"/getting-started/environment-setup","permalink":"/phaser-june/docs/getting-started/environment-setup","draft":false,"unlisted":false,"editUrl":"https://github.com/kc0588615/phaser-june/tree/main/wiki/docs/getting-started/environment-setup.md","tags":[{"inline":true,"label":"setup","permalink":"/phaser-june/docs/tags/setup"},{"inline":true,"label":"database","permalink":"/phaser-june/docs/tags/database"},{"inline":true,"label":"cesium","permalink":"/phaser-june/docs/tags/cesium"},{"inline":true,"label":"titiler","permalink":"/phaser-june/docs/tags/titiler"}],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"title":"Environment Setup","description":"Detailed configuration for all external services","tags":["setup","database","cesium","titiler"]},"sidebar":"docsSidebar","previous":{"title":"Project Structure","permalink":"/phaser-june/docs/getting-started/project-structure"},"next":{"title":"Tutorials","permalink":"/phaser-june/docs/category/tutorials"}}');var t=n(74848),r=n(28453);const l={sidebar_position:3,title:"Environment Setup",description:"Detailed configuration for all external services",tags:["setup","database","cesium","titiler"]},a="Environment Setup",d={},o=[{value:"Environment Variables",id:"environment-variables",level:2},{value:"Required Variables",id:"required-variables",level:3},{value:"Optional Variables",id:"optional-variables",level:3},{value:"Database Setup",id:"database-setup",level:2},{value:"1. Configure Drizzle",id:"1-configure-drizzle",level:3},{value:"2. Required Tables",id:"2-required-tables",level:3},{value:"3. One-Time Stats Backfill",id:"3-one-time-stats-backfill",level:3},{value:"Cesium Ion Setup",id:"cesium-ion-setup",level:2},{value:"1. Get Token",id:"1-get-token",level:3},{value:"2. Asset Access",id:"2-asset-access",level:3},{value:"TiTiler Setup (Optional)",id:"titiler-setup-optional",level:2},{value:"Self-Hosted",id:"self-hosted",level:3},{value:"Cloud-Hosted",id:"cloud-hosted",level:3},{value:"Verify Configuration",id:"verify-configuration",level:2},{value:"Common Issues",id:"common-issues",level:2},{value:"&quot;Database not configured&quot;",id:"database-not-configured",level:3},{value:"&quot;Cesium token invalid&quot;",id:"cesium-token-invalid",level:3},{value:"&quot;TiTiler timeout&quot;",id:"titiler-timeout",level:3},{value:"Next Steps",id:"next-steps",level:2}];function c(e){const i={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i.header,{children:(0,t.jsx)(i.h1,{id:"environment-setup",children:"Environment Setup"})}),"\n",(0,t.jsx)(i.p,{children:"This guide covers detailed configuration for Postgres (Drizzle), Cesium, and optional TiTiler integration."}),"\n",(0,t.jsx)(i.h2,{id:"environment-variables",children:"Environment Variables"}),"\n",(0,t.jsxs)(i.p,{children:["Create ",(0,t.jsx)(i.code,{children:".env.local"})," from the template:"]}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-bash",children:"cp .env.example .env.local\n"})}),"\n",(0,t.jsx)(i.h3,{id:"required-variables",children:"Required Variables"}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-env",children:'# Database - Postgres connection string (Drizzle)\nDATABASE_URL="postgresql://user:password@host:port/database?schema=public&pgbouncer=true"\n\n# Cesium Ion - 3D globe rendering\nNEXT_PUBLIC_CESIUM_ION_TOKEN=your-cesium-ion-token\n\n# Auth - Clerk (TBD)\n# NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=...\n# CLERK_SECRET_KEY=...\n'})}),"\n",(0,t.jsx)(i.h3,{id:"optional-variables",children:"Optional Variables"}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-env",children:"# TiTiler - Raster habitat data processing\nNEXT_PUBLIC_TITILER_BASE_URL=https://your-titiler-endpoint.com\nNEXT_PUBLIC_COG_URL=https://your-s3-bucket/habitat.tif\n"})}),"\n",(0,t.jsx)(i.h2,{id:"database-setup",children:"Database Setup"}),"\n",(0,t.jsx)(i.h3,{id:"1-configure-drizzle",children:"1. Configure Drizzle"}),"\n",(0,t.jsxs)(i.ol,{children:["\n",(0,t.jsx)(i.li,{children:"Ensure you have a PostgreSQL database running (e.g., on Hetzner VPS)."}),"\n",(0,t.jsxs)(i.li,{children:["Set the ",(0,t.jsx)(i.code,{children:"DATABASE_URL"})," in ",(0,t.jsx)(i.code,{children:".env.local"}),"."]}),"\n",(0,t.jsx)(i.li,{children:"Ensure schema is in place:"}),"\n"]}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["Spatial tables (",(0,t.jsx)(i.code,{children:"icaa"}),", ",(0,t.jsx)(i.code,{children:"oneearth_bioregion"}),") are created by shapefile imports."]}),"\n",(0,t.jsx)(i.li,{children:"App tables are created via SQL migrations or manual DDL (Drizzle does not run migrations here)."}),"\n",(0,t.jsx)(i.li,{children:"Refresh types after schema changes:"}),"\n"]}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-bash",children:"npx drizzle-kit introspect\n"})}),"\n",(0,t.jsx)(i.h3,{id:"2-required-tables",children:"2. Required Tables"}),"\n",(0,t.jsxs)(i.p,{children:["The application expects these tables (see ",(0,t.jsx)(i.a,{href:"/docs/guides/data/database-guide",children:"Database Guide"})," for full schema):"]}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"icaa"})," - Species information"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"profiles"})," - Player profiles"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"player_game_sessions"})," - Session tracking"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"player_species_discoveries"})," - Identified species"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"player_clue_unlocks"})," - Unlocked clues"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"player_stats"})," - Aggregated stats"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"habitat_colormap"})," - Habitat codes \u2192 labels (TiTiler)"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"oneearth_bioregion"})," - Bioregion reference data (optional)"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"high_scores"})," - Legacy leaderboard"]}),"\n"]}),"\n",(0,t.jsxs)(i.p,{children:["API routes under ",(0,t.jsx)(i.code,{children:"/api/*"})," handle queries; no database RPCs are required."]}),"\n",(0,t.jsx)(i.h3,{id:"3-one-time-stats-backfill",children:"3. One-Time Stats Backfill"}),"\n",(0,t.jsx)(i.p,{children:"If you applied migrations to an existing database, refresh aggregates once:"}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-bash",children:"npx tsx scripts/backfill-player-stats.ts\n"})}),"\n",(0,t.jsx)(i.h2,{id:"cesium-ion-setup",children:"Cesium Ion Setup"}),"\n",(0,t.jsx)(i.h3,{id:"1-get-token",children:"1. Get Token"}),"\n",(0,t.jsxs)(i.ol,{children:["\n",(0,t.jsxs)(i.li,{children:["Create account at ",(0,t.jsx)(i.a,{href:"https://cesium.com/ion/",children:"cesium.com/ion"})]}),"\n",(0,t.jsx)(i.li,{children:"Go to Access Tokens"}),"\n",(0,t.jsx)(i.li,{children:"Create a new token with default scopes"}),"\n",(0,t.jsxs)(i.li,{children:["Copy to ",(0,t.jsx)(i.code,{children:"NEXT_PUBLIC_CESIUM_ION_TOKEN"})]}),"\n"]}),"\n",(0,t.jsx)(i.h3,{id:"2-asset-access",children:"2. Asset Access"}),"\n",(0,t.jsx)(i.p,{children:"The app uses Cesium's default world terrain and imagery. No additional asset configuration needed for basic setup."}),"\n",(0,t.jsx)(i.h2,{id:"titiler-setup-optional",children:"TiTiler Setup (Optional)"}),"\n",(0,t.jsx)(i.p,{children:"TiTiler provides Cloud-Optimized GeoTIFF (COG) processing for habitat raster data."}),"\n",(0,t.jsx)(i.h3,{id:"self-hosted",children:"Self-Hosted"}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-bash",children:"docker run -p 8000:8000 ghcr.io/developmentseed/titiler:latest\n"})}),"\n",(0,t.jsxs)(i.p,{children:["Set in ",(0,t.jsx)(i.code,{children:".env.local"}),":"]}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-env",children:"NEXT_PUBLIC_TITILER_BASE_URL=http://localhost:8000\nNEXT_PUBLIC_COG_URL=https://your-s3-bucket/habitat.tif\n"})}),"\n",(0,t.jsx)(i.h3,{id:"cloud-hosted",children:"Cloud-Hosted"}),"\n",(0,t.jsx)(i.p,{children:"Use a managed TiTiler instance or deploy to AWS Lambda."}),"\n",(0,t.jsx)(i.h2,{id:"verify-configuration",children:"Verify Configuration"}),"\n",(0,t.jsx)(i.p,{children:"Run the app and check browser console for:"}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{children:"\u2713 Drizzle client reachable\n\u2713 Cesium viewer ready\n\u2713 TiTiler endpoint accessible (if configured)\n"})}),"\n",(0,t.jsx)(i.h2,{id:"common-issues",children:"Common Issues"}),"\n",(0,t.jsx)(i.h3,{id:"database-not-configured",children:'"Database not configured"'}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["Ensure ",(0,t.jsx)(i.code,{children:".env.local"})," exists (not ",(0,t.jsx)(i.code,{children:".env.example"}),")"]}),"\n",(0,t.jsxs)(i.li,{children:["Set ",(0,t.jsx)(i.code,{children:"DATABASE_URL"})," and restart the dev server"]}),"\n"]}),"\n",(0,t.jsx)(i.h3,{id:"cesium-token-invalid",children:'"Cesium token invalid"'}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"Check token hasn't expired"}),"\n",(0,t.jsx)(i.li,{children:"Verify token has required scopes"}),"\n"]}),"\n",(0,t.jsx)(i.h3,{id:"titiler-timeout",children:'"TiTiler timeout"'}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["Check ",(0,t.jsx)(i.code,{children:"NEXT_PUBLIC_TITILER_BASE_URL"})," is correct"]}),"\n",(0,t.jsxs)(i.li,{children:["Verify COG file is accessible at ",(0,t.jsx)(i.code,{children:"NEXT_PUBLIC_COG_URL"})]}),"\n"]}),"\n",(0,t.jsx)(i.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.a,{href:"/docs/getting-started/project-structure",children:"Project Structure"})," - Navigate the codebase"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.a,{href:"/docs/guides/data/database-guide",children:"Database Guide"})," - Full schema reference"]}),"\n"]})]})}function u(e={}){const{wrapper:i}={...(0,r.R)(),...e.components};return i?(0,t.jsx)(i,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}}}]);