"use strict";(globalThis.webpackChunkwiki=globalThis.webpackChunkwiki||[]).push([[49663],{28453(e,n,t){t.d(n,{R:()=>a,x:()=>l});var s=t(96540);const i={},r=s.createContext(i);function a(e){const n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(r.Provider,{value:n},e.children)}},88353(e,n,t){t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"tutorials/react-phaser-bridge","title":"React-Phaser Bridge","description":"Master the EventBus pattern for cross-framework communication","source":"@site/docs/tutorials/react-phaser-bridge.md","sourceDirName":"tutorials","slug":"/tutorials/react-phaser-bridge","permalink":"/phaser-june/docs/tutorials/react-phaser-bridge","draft":false,"unlisted":false,"editUrl":"https://github.com/kc0588615/phaser-june/tree/main/wiki/docs/tutorials/react-phaser-bridge.md","tags":[{"inline":true,"label":"tutorial","permalink":"/phaser-june/docs/tags/tutorial"},{"inline":true,"label":"eventbus","permalink":"/phaser-june/docs/tags/eventbus"},{"inline":true,"label":"react","permalink":"/phaser-june/docs/tags/react"},{"inline":true,"label":"phaser","permalink":"/phaser-june/docs/tags/phaser"}],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"title":"React-Phaser Bridge","description":"Master the EventBus pattern for cross-framework communication","tags":["tutorial","eventbus","react","phaser"]},"sidebar":"docsSidebar","previous":{"title":"Your First Phaser Scene","permalink":"/phaser-june/docs/tutorials/first-phaser-scene"},"next":{"title":"Cesium Integration","permalink":"/phaser-june/docs/tutorials/cesium-integration"}}');var i=t(74848),r=t(28453);const a={sidebar_position:2,title:"React-Phaser Bridge",description:"Master the EventBus pattern for cross-framework communication",tags:["tutorial","eventbus","react","phaser"]},l="Tutorial: React-Phaser Bridge",c={},o=[{value:"The Challenge",id:"the-challenge",level:2},{value:"How EventBus Works",id:"how-eventbus-works",level:2},{value:"Pattern 1: React \u2192 Phaser",id:"pattern-1-react--phaser",level:2},{value:"React Side (CesiumMap.tsx)",id:"react-side-cesiummaptsx",level:3},{value:"Phaser Side (Game.ts)",id:"phaser-side-gamets",level:3},{value:"Pattern 2: Phaser \u2192 React",id:"pattern-2-phaser--react",level:2},{value:"Phaser Side (Game.ts)",id:"phaser-side-gamets-1",level:3},{value:"React Side (SpeciesPanel.tsx)",id:"react-side-speciespaneltsx",level:3},{value:"Pattern 3: Bidirectional Communication",id:"pattern-3-bidirectional-communication",level:2},{value:"Adding a New Event",id:"adding-a-new-event",level:2},{value:"Step 1: Define the Type",id:"step-1-define-the-type",level:3},{value:"Step 2: Emit from Source",id:"step-2-emit-from-source",level:3},{value:"Step 3: Listen in Target",id:"step-3-listen-in-target",level:3},{value:"Common Mistakes",id:"common-mistakes",level:2},{value:"Mistake 1: Forgetting Cleanup",id:"mistake-1-forgetting-cleanup",level:3},{value:"Mistake 2: Conditional Rendering",id:"mistake-2-conditional-rendering",level:3},{value:"Mistake 3: Wrong Context",id:"mistake-3-wrong-context",level:3},{value:"Debugging EventBus",id:"debugging-eventbus",level:2},{value:"Exercise: Add Score Event",id:"exercise-add-score-event",level:2},{value:"Summary",id:"summary",level:2},{value:"Next Tutorial",id:"next-tutorial",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"tutorial-react-phaser-bridge",children:"Tutorial: React-Phaser Bridge"})}),"\n",(0,i.jsx)(n.p,{children:"Learn how Critter Connect bridges React and Phaser through the EventBus pattern."}),"\n",(0,i.jsx)(n.h2,{id:"the-challenge",children:"The Challenge"}),"\n",(0,i.jsx)(n.p,{children:"React and Phaser operate in different worlds:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"React"}),(0,i.jsx)(n.th,{children:"Phaser"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Declarative rendering"}),(0,i.jsx)(n.td,{children:"Imperative game loop"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Virtual DOM"}),(0,i.jsx)(n.td,{children:"Canvas rendering"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Component state"}),(0,i.jsx)(n.td,{children:"Scene properties"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Hooks lifecycle"}),(0,i.jsx)(n.td,{children:"Scene lifecycle"})]})]})]}),"\n",(0,i.jsx)(n.p,{children:"They cannot directly access each other. The EventBus solves this."}),"\n",(0,i.jsx)(n.h2,{id:"how-eventbus-works",children:"How EventBus Works"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Location:"})," ",(0,i.jsx)(n.code,{children:"src/game/EventBus.ts"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import Phaser from 'phaser';\n\nclass TypedEventBus extends Phaser.Events.EventEmitter {\n  emit<K extends keyof EventPayloads>(\n    event: K,\n    ...args: [EventPayloads[K]]\n  ): boolean {\n    return super.emit(event, ...args);\n  }\n\n  on<K extends keyof EventPayloads>(\n    event: K,\n    fn: (arg: EventPayloads[K]) => void,\n    context?: any\n  ): this {\n    return super.on(event, fn, context);\n  }\n}\n\nexport const EventBus = new TypedEventBus();\n"})}),"\n",(0,i.jsxs)(n.p,{children:["It's a ",(0,i.jsx)(n.strong,{children:"typed pub/sub system"})," where:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Any component can ",(0,i.jsx)(n.strong,{children:"publish"})," (emit) events"]}),"\n",(0,i.jsxs)(n.li,{children:["Any component can ",(0,i.jsx)(n.strong,{children:"subscribe"})," (listen) to events"]}),"\n",(0,i.jsx)(n.li,{children:"TypeScript ensures payloads match expected types"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"pattern-1-react--phaser",children:"Pattern 1: React \u2192 Phaser"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Example:"})," Sending map selection to game"]}),"\n",(0,i.jsx)(n.h3,{id:"react-side-cesiummaptsx",children:"React Side (CesiumMap.tsx)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import { EventBus } from '@/game/EventBus';\n\nconst handleMapClick = (lon: number, lat: number, species: Species[]) => {\n  EventBus.emit('cesium-location-selected', {\n    lon,\n    lat,\n    species,\n    habitats: [],\n    rasterHabitats: []\n  });\n};\n"})}),"\n",(0,i.jsx)(n.h3,{id:"phaser-side-gamets",children:"Phaser Side (Game.ts)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"create() {\n  EventBus.on('cesium-location-selected', this.initializeBoardFromCesium, this);\n}\n\nprivate initializeBoardFromCesium(data: {\n  lon: number;\n  lat: number;\n  species: Species[];\n}) {\n  // Use the data to set up the game board\n  this.selectedSpecies = data.species[0];\n  this.createBoard();\n}\n\nshutdown() {\n  EventBus.off('cesium-location-selected', this.initializeBoardFromCesium, this);\n}\n"})}),"\n",(0,i.jsx)(n.admonition,{title:"Context Binding",type:"warning",children:(0,i.jsxs)(n.p,{children:["Always pass ",(0,i.jsx)(n.code,{children:"this"})," as the third argument to ",(0,i.jsx)(n.code,{children:"EventBus.on()"})," in Phaser scenes. This ensures ",(0,i.jsx)(n.code,{children:"this"})," refers to the scene inside the handler."]})}),"\n",(0,i.jsx)(n.h2,{id:"pattern-2-phaser--react",children:"Pattern 2: Phaser \u2192 React"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Example:"})," Sending clue discoveries to UI"]}),"\n",(0,i.jsx)(n.h3,{id:"phaser-side-gamets-1",children:"Phaser Side (Game.ts)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"private revealClue(category: GemCategory, clueText: string) {\n  EventBus.emit('clue-revealed', {\n    category,\n    heading: CLUE_CONFIG.categories[category].displayName,\n    clue: clueText,\n    speciesId: this.selectedSpecies.id,\n    name: CLUE_CONFIG.categories[category].displayName,\n    icon: CLUE_CONFIG.categories[category].icon,\n    color: this.categoryToColor(category)\n  });\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"react-side-speciespaneltsx",children:"React Side (SpeciesPanel.tsx)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import { useEffect, useState } from 'react';\nimport { EventBus } from '@/game/EventBus';\nimport type { CluePayload } from '@/game/EventBus';\n\nexport function SpeciesPanel() {\n  const [clues, setClues] = useState<CluePayload[]>([]);\n\n  useEffect(() => {\n    const handleClueRevealed = (clueData: CluePayload) => {\n      setClues(prev => [...prev, clueData]);\n    };\n\n    EventBus.on('clue-revealed', handleClueRevealed);\n\n    return () => {\n      EventBus.off('clue-revealed', handleClueRevealed);\n    };\n  }, []);\n\n  return (\n    <div>\n      {clues.map((clue, i) => (\n        <div key={i}>{clue.clue}</div>\n      ))}\n    </div>\n  );\n}\n"})}),"\n",(0,i.jsx)(n.admonition,{title:"useEffect Cleanup",type:"tip",children:(0,i.jsx)(n.p,{children:"Always return a cleanup function that removes the listener. This prevents memory leaks and duplicate handlers."})}),"\n",(0,i.jsx)(n.h2,{id:"pattern-3-bidirectional-communication",children:"Pattern 3: Bidirectional Communication"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Example:"})," Species guess flow"]}),"\n",(0,i.jsx)(n.mermaid,{value:"sequenceDiagram\n    participant React as SpeciesGuessSelector\n    participant EventBus\n    participant Phaser as Game.ts\n\n    React->>EventBus: emit('species-guess-submitted', guess)\n    EventBus->>Phaser: handleSpeciesGuess(guess)\n    Phaser->>Phaser: Validate guess\n    alt Correct\n        Phaser->>EventBus: emit('guess-result', { correct: true })\n    else Incorrect\n        Phaser->>EventBus: emit('guess-result', { correct: false })\n    end\n    EventBus->>React: Show result UI"}),"\n",(0,i.jsx)(n.h2,{id:"adding-a-new-event",children:"Adding a New Event"}),"\n",(0,i.jsx)(n.h3,{id:"step-1-define-the-type",children:"Step 1: Define the Type"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// src/game/EventBus.ts\nexport interface EventPayloads {\n  // ... existing events\n  'my-new-event': {\n    data: string;\n    count: number;\n  };\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"step-2-emit-from-source",children:"Step 2: Emit from Source"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"EventBus.emit('my-new-event', { data: 'hello', count: 42 });\n"})}),"\n",(0,i.jsx)(n.h3,{id:"step-3-listen-in-target",children:"Step 3: Listen in Target"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"EventBus.on('my-new-event', (payload) => {\n  console.log(payload.data);  // TypeScript knows this is string!\n  console.log(payload.count); // TypeScript knows this is number!\n});\n"})}),"\n",(0,i.jsx)(n.h2,{id:"common-mistakes",children:"Common Mistakes"}),"\n",(0,i.jsx)(n.h3,{id:"mistake-1-forgetting-cleanup",children:"Mistake 1: Forgetting Cleanup"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// BAD - Memory leak!\nuseEffect(() => {\n  EventBus.on('event', handler);\n}, []);\n\n// GOOD\nuseEffect(() => {\n  EventBus.on('event', handler);\n  return () => EventBus.off('event', handler);\n}, []);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"mistake-2-conditional-rendering",children:"Mistake 2: Conditional Rendering"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-tsx",children:"// BAD - Unmounts component, loses listeners\n{showPanel && <SpeciesPanel />}\n\n// GOOD - Keeps component mounted\n<div style={{ display: showPanel ? 'block' : 'none' }}>\n  <SpeciesPanel />\n</div>\n"})}),"\n",(0,i.jsx)(n.h3,{id:"mistake-3-wrong-context",children:"Mistake 3: Wrong Context"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// BAD - `this` is undefined\nEventBus.on('event', this.handleEvent);\n\n// GOOD - Pass context\nEventBus.on('event', this.handleEvent, this);\n\n// ALSO GOOD - Arrow function\nEventBus.on('event', (data) => this.handleEvent(data));\n"})}),"\n",(0,i.jsx)(n.h2,{id:"debugging-eventbus",children:"Debugging EventBus"}),"\n",(0,i.jsx)(n.p,{children:"Add global logging in development:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// src/game/EventBus.ts\nif (process.env.NODE_ENV === 'development') {\n  const originalEmit = EventBus.emit.bind(EventBus);\n  EventBus.emit = function(event, ...args) {\n    console.log(`[EventBus] ${String(event)}`, ...args);\n    return originalEmit(event as any, ...args);\n  };\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"exercise-add-score-event",children:"Exercise: Add Score Event"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Define a new event for score updates:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// EventBus.ts\n'score-updated': { score: number; combo: number };\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"2",children:["\n",(0,i.jsx)(n.li,{children:"Emit from Game.ts when score changes:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"this.score += points;\nEventBus.emit('score-updated', { score: this.score, combo: this.combo });\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"3",children:["\n",(0,i.jsx)(n.li,{children:"Display in a React component:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"const [score, setScore] = useState(0);\n\nuseEffect(() => {\n  const handler = (data: { score: number }) => setScore(data.score);\n  EventBus.on('score-updated', handler);\n  return () => EventBus.off('score-updated', handler);\n}, []);\n"})}),"\n",(0,i.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"EventBus is a typed pub/sub system"}),"\n",(0,i.jsx)(n.li,{children:"React \u2192 Phaser: emit from component, listen in scene"}),"\n",(0,i.jsx)(n.li,{children:"Phaser \u2192 React: emit from scene, listen in useEffect"}),"\n",(0,i.jsx)(n.li,{children:"Always clean up listeners"}),"\n",(0,i.jsx)(n.li,{children:"Keep components mounted to preserve listeners"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"next-tutorial",children:"Next Tutorial"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"/docs/tutorials/cesium-integration",children:"Cesium Integration"})," - Adding 3D globe interactions"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}}}]);