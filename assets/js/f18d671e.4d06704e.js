"use strict";(globalThis.webpackChunkwiki=globalThis.webpackChunkwiki||[]).push([[16867],{5813(e,s,a){a.r(s),a.d(s,{assets:()=>d,contentTitle:()=>c,default:()=>p,frontMatter:()=>t,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"guides/data/database-guide","title":"Database User Guide","description":"Working with Postgres tables and Prisma queries","source":"@site/docs/guides/data/database-guide.md","sourceDirName":"guides/data","slug":"/guides/data/database-guide","permalink":"/phaser-june/docs/guides/data/database-guide","draft":false,"unlisted":false,"editUrl":"https://github.com/kc0588615/phaser-june/tree/main/wiki/docs/guides/data/database-guide.md","tags":[{"inline":true,"label":"guide","permalink":"/phaser-june/docs/tags/guide"},{"inline":true,"label":"database","permalink":"/phaser-june/docs/tags/database"},{"inline":true,"label":"postgres","permalink":"/phaser-june/docs/tags/postgres"},{"inline":true,"label":"prisma","permalink":"/phaser-june/docs/tags/prisma"}],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"title":"Database User Guide","description":"Working with Postgres tables and Prisma queries","tags":["guide","database","postgres","prisma"]},"sidebar":"docsSidebar","previous":{"title":"Species List Improvements","permalink":"/phaser-june/docs/guides/ui/species-list-improvements"},"next":{"title":"Species Database","permalink":"/phaser-june/docs/guides/data/species-database"}}');var n=a(74848),r=a(28453);const t={sidebar_position:1,title:"Database User Guide",description:"Working with Postgres tables and Prisma queries",tags:["guide","database","postgres","prisma"]},c="Database User Guide",d={},o=[{value:"Prisma Client Setup",id:"prisma-client-setup",level:2},{value:"Querying Species",id:"querying-species",level:2},{value:"By Location (Raw SQL for PostGIS)",id:"by-location-raw-sql-for-postgis",level:3},{value:"By ID",id:"by-id",level:3},{value:"Search by Name",id:"search-by-name",level:3},{value:"Recording Game Data",id:"recording-game-data",level:2},{value:"Start Session",id:"start-session",level:3},{value:"Record Discovery",id:"record-discovery",level:3},{value:"React Query Integration",id:"react-query-integration",level:2},{value:"Related",id:"related",level:2}];function l(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.header,{children:(0,n.jsx)(s.h1,{id:"database-user-guide",children:"Database User Guide"})}),"\n",(0,n.jsx)(s.p,{children:"Practical guide for querying species data and recording player progress."}),"\n",(0,n.jsx)(s.h2,{id:"prisma-client-setup",children:"Prisma Client Setup"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-typescript",children:"// src/lib/prisma.ts\nimport { PrismaClient } from '@prisma/client';\n\nconst globalForPrisma = global as unknown as { prisma: PrismaClient };\n\nexport const prisma = globalForPrisma.prisma || new PrismaClient();\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma;\n"})}),"\n",(0,n.jsx)(s.h2,{id:"querying-species",children:"Querying Species"}),"\n",(0,n.jsx)(s.h3,{id:"by-location-raw-sql-for-postgis",children:"By Location (Raw SQL for PostGIS)"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-typescript",children:'// src/lib/speciesQueries.ts\nconst species = await prisma.$queryRaw`\n  SELECT * FROM "icaa_species"\n  WHERE ST_DWithin(\n    geom,\n    ST_SetSRID(ST_MakePoint(${lon}, ${lat}), 4326),\n    ${radius}\n  )\n`;\n'})}),"\n",(0,n.jsx)(s.h3,{id:"by-id",children:"By ID"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-typescript",children:"const species = await prisma.icaa_species.findUnique({\n  where: { id: speciesId }\n});\n"})}),"\n",(0,n.jsx)(s.h3,{id:"search-by-name",children:"Search by Name"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-typescript",children:"const { data } = await supabase\n  .from('icaa_species')\n  .select('id, common_name, sci_name')\n  .ilike('common_name', `%${searchTerm}%`)\n  .limit(10);\n"})}),"\n",(0,n.jsx)(s.h2,{id:"recording-game-data",children:"Recording Game Data"}),"\n",(0,n.jsx)(s.h3,{id:"start-session",children:"Start Session"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-typescript",children:"const { data: session } = await supabase\n  .from('game_sessions')\n  .insert({\n    player_id: userId,\n    location_lon: lon,\n    location_lat: lat,\n    total_species: speciesCount\n  })\n  .select()\n  .single();\n"})}),"\n",(0,n.jsx)(s.h3,{id:"record-discovery",children:"Record Discovery"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-typescript",children:"await supabase.rpc('record_species_discovery', {\n  p_session_id: sessionId,\n  p_species_id: speciesId,\n  p_guess_count: attempts\n});\n"})}),"\n",(0,n.jsx)(s.h2,{id:"react-query-integration",children:"React Query Integration"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-typescript",children:"// src/hooks/useSpeciesData.ts\nimport { useQuery } from '@tanstack/react-query';\n\nexport function useSpeciesAtLocation(lon: number, lat: number) {\n  return useQuery({\n    queryKey: ['species', lon, lat],\n    queryFn: () => getSpeciesAtLocation(lon, lat),\n    enabled: !!lon && !!lat\n  });\n}\n"})}),"\n",(0,n.jsx)(s.h2,{id:"related",children:"Related"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsx)(s.li,{children:(0,n.jsx)(s.a,{href:"/docs/reference/database-schema",children:"Database Schema Reference"})}),"\n",(0,n.jsx)(s.li,{children:(0,n.jsx)(s.a,{href:"/docs/guides/data/species-database",children:"Species Database Implementation"})}),"\n"]})]})}function p(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,n.jsx)(s,{...e,children:(0,n.jsx)(l,{...e})}):l(e)}},28453(e,s,a){a.d(s,{R:()=>t,x:()=>c});var i=a(96540);const n={},r=i.createContext(n);function t(e){const s=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:t(e.components),i.createElement(r.Provider,{value:s},e.children)}}}]);