"use strict";(globalThis.webpackChunkwiki=globalThis.webpackChunkwiki||[]).push([[61423],{28453(e,s,i){i.d(s,{R:()=>t,x:()=>r});var n=i(96540);const a={},l=n.createContext(a);function t(e){const s=n.useContext(l);return n.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function r(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:t(e.components),n.createElement(l.Provider,{value:s},e.children)}},77584(e,s,i){i.r(s),i.d(s,{assets:()=>d,contentTitle:()=>r,default:()=>h,frontMatter:()=>t,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"guides/data/drizzle-orm","title":"Drizzle ORM Guide","description":"Using Drizzle with the database","source":"@site/docs/guides/data/drizzle-orm.md","sourceDirName":"guides/data","slug":"/guides/data/drizzle-orm","permalink":"/phaser-june/docs/guides/data/drizzle-orm","draft":false,"unlisted":false,"editUrl":"https://github.com/kc0588615/phaser-june/tree/main/wiki/docs/guides/data/drizzle-orm.md","tags":[{"inline":true,"label":"guide","permalink":"/phaser-june/docs/tags/guide"},{"inline":true,"label":"drizzle","permalink":"/phaser-june/docs/tags/drizzle"},{"inline":true,"label":"orm","permalink":"/phaser-june/docs/tags/orm"}],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"title":"Drizzle ORM Guide","description":"Using Drizzle with the database","tags":["guide","drizzle","orm"]},"sidebar":"docsSidebar","previous":{"title":"Species Database","permalink":"/phaser-june/docs/guides/data/species-database"},"next":{"title":"Drizzle Vercel Deployment","permalink":"/phaser-june/docs/guides/data/drizzle-vercel-migration"}}');var a=i(74848),l=i(28453);const t={sidebar_position:3,title:"Drizzle ORM Guide",description:"Using Drizzle with the database",tags:["guide","drizzle","orm"]},r="Drizzle ORM Guide",d={},c=[{value:"Conventions",id:"conventions",level:2},{value:"Schema Locations",id:"schema-locations",level:2},{value:"Client Usage",id:"client-usage",level:2},{value:"PostGIS Raw SQL",id:"postgis-raw-sql",level:2},{value:"Schema Changes",id:"schema-changes",level:2},{value:"Checklist",id:"checklist",level:3},{value:"Notes",id:"notes",level:2}];function o(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",input:"input",li:"li",p:"p",pre:"pre",ul:"ul",...(0,l.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s.header,{children:(0,a.jsx)(s.h1,{id:"drizzle-orm-guide",children:"Drizzle ORM Guide"})}),"\n",(0,a.jsx)(s.p,{children:"Drizzle provides type-safe access to Postgres and PostGIS in this codebase."}),"\n",(0,a.jsx)(s.h2,{id:"conventions",children:"Conventions"}),"\n",(0,a.jsx)(s.p,{children:"Follow these for app-owned tables and raw SQL:"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsx)(s.li,{children:"Lowercase snake_case; tables plural, columns singular"}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"id"})," bigint identity PKs (UUID only for external IDs like auth)"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"timestamptz"}),", ",(0,a.jsx)(s.code,{children:"text"}),", ",(0,a.jsx)(s.code,{children:"jsonb"}),"; avoid ",(0,a.jsx)(s.code,{children:"timestamp"}),", ",(0,a.jsx)(s.code,{children:"varchar(n)"}),", ",(0,a.jsx)(s.code,{children:"json"})]}),"\n",(0,a.jsxs)(s.li,{children:["Name constraints/indexes: ",(0,a.jsx)(s.code,{children:"ix_"}),"/",(0,a.jsx)(s.code,{children:"uq_"}),"/",(0,a.jsx)(s.code,{children:"fk_"}),"/",(0,a.jsx)(s.code,{children:"ck_"})," prefixes"]}),"\n",(0,a.jsx)(s.li,{children:"Always alias tables in raw SQL"}),"\n"]}),"\n",(0,a.jsxs)(s.p,{children:["See ",(0,a.jsx)(s.a,{href:"/docs/guides/data/database-guide",children:"DATABASE_USER_GUIDE.md"})," for full conventions."]}),"\n",(0,a.jsx)(s.h2,{id:"schema-locations",children:"Schema Locations"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"src/db/schema/*"})," - table definitions (app tables + spatial mappings)"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"src/db/types.ts"})," - inferred TypeScript types"]}),"\n"]}),"\n",(0,a.jsx)(s.h2,{id:"client-usage",children:"Client Usage"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-typescript",children:"import { db, icaa } from '@/db';\nimport { eq } from 'drizzle-orm';\n\nconst species = await db\n  .select()\n  .from(icaa)\n  .where(eq(icaa.family, 'FELIDAE'));\n"})}),"\n",(0,a.jsx)(s.h2,{id:"postgis-raw-sql",children:"PostGIS Raw SQL"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-typescript",children:"import { sql } from 'drizzle-orm';\nimport { db } from '@/db';\n\n// Use radius function with table alias (best practice)\nconst results = await db.execute(sql`\n  SELECT r.ogc_fid, r.comm_name\n  FROM public.get_species_in_radius(${lon}, ${lat}, ${radiusMeters}) r\n`);\n"})}),"\n",(0,a.jsx)(s.h2,{id:"schema-changes",children:"Schema Changes"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsx)(s.li,{children:"Spatial tables are created/modified by shapefile imports and QGIS edits (treat as read-only)."}),"\n",(0,a.jsxs)(s.li,{children:["App tables are managed via SQL DDL; update ",(0,a.jsx)(s.code,{children:"src/db/schema/*"})," to match."]}),"\n",(0,a.jsx)(s.li,{children:"Follow naming/type conventions; explicitly name constraints/indexes."}),"\n",(0,a.jsx)(s.li,{children:"After any schema change, refresh types with:"}),"\n"]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"npm run db:introspect\n"})}),"\n",(0,a.jsx)(s.h3,{id:"checklist",children:"Checklist"}),"\n",(0,a.jsx)(s.p,{children:"Before shipping a schema change:"}),"\n",(0,a.jsxs)(s.ul,{className:"contains-task-list",children:["\n",(0,a.jsxs)(s.li,{className:"task-list-item",children:[(0,a.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Table/column names: snake_case, tables plural, columns singular"]}),"\n",(0,a.jsxs)(s.li,{className:"task-list-item",children:[(0,a.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Types: ",(0,a.jsx)(s.code,{children:"timestamptz"}),", ",(0,a.jsx)(s.code,{children:"text"}),", ",(0,a.jsx)(s.code,{children:"jsonb"}),", ",(0,a.jsx)(s.code,{children:"numeric"})," for money"]}),"\n",(0,a.jsxs)(s.li,{className:"task-list-item",children:[(0,a.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Named constraints: ",(0,a.jsx)(s.code,{children:"ix_"}),"/",(0,a.jsx)(s.code,{children:"uq_"}),"/",(0,a.jsx)(s.code,{children:"fk_"}),"/",(0,a.jsx)(s.code,{children:"ck_"})," prefixes"]}),"\n",(0,a.jsxs)(s.li,{className:"task-list-item",children:[(0,a.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Indexes for FKs and hot query paths"]}),"\n"]}),"\n",(0,a.jsx)(s.h2,{id:"notes",children:"Notes"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsx)(s.li,{children:"Drizzle migrations are not used in this repo."}),"\n",(0,a.jsx)(s.li,{children:"Use explicit column aliases to keep API responses in snake_case."}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,l.R)(),...e.components};return s?(0,a.jsx)(s,{...e,children:(0,a.jsx)(o,{...e})}):o(e)}}}]);